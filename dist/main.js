(()=>{"use strict";const e=e=>e.sort(((e,t)=>parseFloat(t.score)-parseFloat(e.score))),t=(e,t)=>{const o=document.querySelector(t);o.innerHTML="";for(let t=0;t<e.length;t++){const a=document.createElement("tr"),r=document.createElement("td"),n=document.createElement("td"),c=document.createElement("td");r.textContent=e[t].index,n.textContent=e[t].username,c.textContent=e[t].score,a.appendChild(r),a.appendChild(n),a.appendChild(c),o.appendChild(a)}},o=(o,a)=>{const r=e(o);console.log(r),r.forEach((e=>{e.index=r.indexOf(e)+1})),t(r,a);const n=document.querySelector("#modal-leaderboard-table");n.rows[1]&&n.rows[1].classList.add("first-place"),n.rows[2]&&n.rows[2].classList.add("second-place"),n.rows[3]&&n.rows[3].classList.add("third-place")},a=e=>{let t=[];switch(e){case"easy":t="valueEasy";break;case"medium":t="valueMedium";break;case"hard":t="valueHard"}return t},r=e=>{const t=[...new Set(e.map((e=>e.username)))],o={},a=[];return t.forEach((e=>{o[e]=[]})),t.forEach((t=>{e.forEach((e=>{e.username===t&&o[t].push(e.score)}));const r=Math.max(...o[t]);o[t]=Math.round(o[t].reduce(((e,t)=>e+t),0)/o[t].length),a.push({username:t,averageScore:o[t],score:r})})),console.log(a),a},n=e=>{if(localStorage.hasOwnProperty("valueEasy")&&localStorage.hasOwnProperty("valueMedium")&&localStorage.hasOwnProperty("valueHard"))o(r(JSON.parse(localStorage.getItem(`value${e}`))),"#modal-leaderboard-body");else{function t(){localStorage.hasOwnProperty("valueHard")?o(r(JSON.parse(localStorage.getItem(`value${e}`))),"#modal-leaderboard-body"):setTimeout(t,0)}(()=>{const e=new Headers;e.append("Content-Type","application/json"),e.append("api-key","0G69rg8K92WdEkothR9aIJ7CYYS01M2nuqYn4nBJjCB1AJBpX8scJBkmVTBtENKZ");const t=JSON.stringify({collection:"Highscores",database:"Hearthstone",dataSource:"Cluster0",filter:{_id:{$oid:"62c7f77c2e005ae745331566"}}});fetch("https://myhearthstoneproxy.herokuapp.com/https://data.mongodb-api.com/app/data-yfusd/endpoint/data/v1/action/findOne",{method:"POST",headers:e,body:t,redirect:"follow"}).then((e=>e.json())).then((e=>{localStorage.setItem("valueEasy",JSON.stringify(e.document.valueEasy)),localStorage.setItem("valueMedium",JSON.stringify(e.document.valueMedium)),localStorage.setItem("valueHard",JSON.stringify(e.document.valueHard))})).catch((e=>console.log("error",e)))})(),setTimeout(t,0)}},c=[".name-coverup",".card-art-coverup",".mana-cost-coverup",".attack-value-coverup",".health-value-coverup"],s=(e,t)=>{const o=[];switch(t){case"easy":o.push(c[0]);break;case"medium":o.push(c[0],c[1]);break;case"hard":o.push(c[0],c[1],(a=c.slice(2))[Math.floor(Math.random()*a.length)]);break;case"all":o.push(...c)}var a;Array.from(document.querySelectorAll(o)).forEach((function(t){t.style.display=e}))},l={value:1e3},d={},u=()=>{d.refreshId=setInterval((()=>{const e=(l.value-=5,l.value);document.querySelector("#timer").textContent=e,e<105&&clearInterval(d.refreshId)}),100)},i=document.querySelector("#leaderboard");new MutationObserver((function(e,t){for(const t of e)"childList"===t.type&&(document.querySelector("#play-area-wrapper").style.display="none",document.querySelector(".game-over-wrapper").style.display="flex")})).observe(i,{attributes:!0,childList:!0,subtree:!0});const m=o=>{const r=document.querySelector("#choose-game-mode").value;((o,r,n)=>{const c=a(n),s=new Headers;s.append("Content-Type","application/json"),s.append("api-key","0G69rg8K92WdEkothR9aIJ7CYYS01M2nuqYn4nBJjCB1AJBpX8scJBkmVTBtENKZ");const l={collection:"Highscores",database:"Hearthstone",dataSource:"Cluster0",filter:{_id:{$oid:"62c7f77c2e005ae745331566"}},update:{$push:{}}};l.update.$push[c]={username:o,score:r};const d=JSON.stringify(l);fetch("https://myhearthstoneproxy.herokuapp.com/https://data.mongodb-api.com/app/data-yfusd/endpoint/data/v1/action/updateOne",{method:"POST",headers:s,body:d,redirect:"follow"}).then((e=>e.json())).then((o=>((o,r)=>{const n=a(o),c=new Headers;c.append("Content-Type","application/json"),c.append("api-key","0G69rg8K92WdEkothR9aIJ7CYYS01M2nuqYn4nBJjCB1AJBpX8scJBkmVTBtENKZ");const s=JSON.stringify({collection:"Highscores",database:"Hearthstone",dataSource:"Cluster0",filter:{_id:{$oid:"62c7f77c2e005ae745331566"}}});fetch("https://myhearthstoneproxy.herokuapp.com/https://data.mongodb-api.com/app/data-yfusd/endpoint/data/v1/action/findOne",{method:"POST",headers:c,body:s,redirect:"follow"}).then((e=>e.json())).then((o=>{localStorage.setItem("valueEasy",JSON.stringify(o.document.valueEasy)),localStorage.setItem("valueMedium",JSON.stringify(o.document.valueMedium)),localStorage.setItem("valueHard",JSON.stringify(o.document.valueHard)),((o,a)=>{console.log(o);const r=o[o.length-1];console.log(r);const n=e(o);n.forEach((e=>{e.index=n.indexOf(e)+1}));const c=n.slice(0,5),s=n.indexOf(r);let l;l=s<=8?n.slice(0,s+4):c.concat(n.slice(s-3,s+4));const d=l.indexOf(r)+1;t(l,"#leaderboard-body"),document.querySelector("#leaderboard-table").rows[d].classList.add("highlighted-class"),c.every((e=>l.includes(e)))&&document.querySelector("#leaderboard-table").rows[5].classList.add("black-bottom-border")})(o.document[n])})).catch((e=>console.log("error",e)))})(n))).catch((e=>console.log("error",e)))})(localStorage.getItem("username"),o,r),document.querySelector("#final-score").innerHTML=`<b> ${o} </b>`,clearInterval(d.refreshId),document.querySelector("#test-mode-answer").textContent="",document.querySelector("#test-mode-answer-container").style.visibility="hidden"};document.getElementById("start-game").addEventListener("click",(async()=>{"nothing"===document.querySelector("#choose-game-mode").value?alert("Please choose difficulty."):null===localStorage.getItem("username")?alert("Please choose your username."):(document.querySelector("#start-game").disabled=!0,document.querySelector("#home-wrapper").style.display="none",(async e=>{const t=document.querySelector("#test-mode-answer"),o=()=>{!0===document.querySelector("#test-mode").checked&&(t.textContent=i.name)},a=document.querySelector("#answer-input"),r=document.querySelector("#skip-card-button");a.readOnly=!1,a.value="",r.disabled=!1,l.value=1e3;let n=0;document.querySelector("#player-score").innerHTML=0;let c=0;document.querySelector("#card-count").innerHTML=`${c+1}/5`;let i=e[c];((e,t,o,a,r)=>{const n=document.createElement("img");n.src=e,n.id="random-card",n.className="random-card undefined",document.getElementById("card-image-container").appendChild(n)})(i.img),s("block",document.querySelector("#choose-game-mode").value),o();const p=()=>{document.querySelector("#card-count").innerHTML=`${c+1}/5`,s("block",document.querySelector("#choose-game-mode").value),a.value="",i=e[c],document.querySelector("#random-card").src=i.img,l.value=1e3,u(),o()},y=()=>{m(n),r.removeEventListener("click",r.skip),a.removeEventListener("input",a.typeAnswer)},h=()=>{clearInterval(d.refreshId),s("none","all"),c++};r.addEventListener("click",r.skip=function(){h(),r.disabled=!0,5!=c?setTimeout((function(){p(),r.disabled=!1}),1e3):y()}),a.addEventListener("input",a.typeAnswer=function(){if(0===a.value.localeCompare(i.name,void 0,{sensitivity:"base"})){if(a.readOnly=!0,h(),n+=l.value,document.querySelector("#player-score").innerHTML=`<b> ${n} </b>`,5==c)return void y();setTimeout((function(){p(),a.readOnly=!1}),1e3)}})})(await(async()=>{const e=await(async()=>(await fetch("https://omgvamp-hearthstone-v1.p.rapidapi.com/cards/sets/Legacy?collectible=1",{method:"GET",headers:{"X-RapidAPI-Key":"91bd8f54b6mshce8e72a14a5f7fbp169d93jsnf3fc17b9ea30","X-RapidAPI-Host":"omgvamp-hearthstone-v1.p.rapidapi.com"}})).json())(),t=[];t.push(e.filter((e=>"Minion"===e.type&&Object.keys(e).includes("img"))));const o=((e,t)=>{const o=Array.from({length:e},((e,t)=>t)),a=[];for(let e=0;e<5;e++){const e=Math.floor(Math.random()*o.length);a.push(o[e]),o.splice(e,1)}return a})(t[0].length),a=[];return o.map((e=>a.push(t[0][e]))),a})()),window.setTimeout((()=>{document.querySelector(".play-area-wrapper").style.display="flex",u(),1==document.querySelector("#test-mode").checked&&(document.querySelector("#test-mode-answer-container").style.visibility="visible")}),500))})),document.querySelector("#username-input-button").addEventListener("click",(()=>{const e=document.querySelector("#username-input").value;""===e?alert("Please choose your username."):/^[a-zA-Z0-9]{3,24}$/.test(e)?(localStorage.setItem("username",e),document.querySelector("#username-modal-container").classList.remove("show"),document.querySelector("#username-button").textContent=e):alert("Username may only contain letters and numbers and must be at least 3 and up to 24 characters long.")})),document.querySelector("#show-instructions").addEventListener("click",(()=>{document.querySelector("#instructions-modal-container").classList.add("show")})),document.querySelector("#close-modal-instructions").addEventListener("click",(()=>{document.querySelector("#instructions-modal-container").classList.remove("show")})),document.querySelector("#show-leaderboard").addEventListener("click",(()=>{document.querySelector("#leaderboard-modal-container").classList.add("show"),n("Easy"),document.querySelector("#leaderboard-easy").checked=!0})),document.querySelector("#play-again-button").addEventListener("click",(()=>{document.querySelector("#random-card").remove(),document.querySelector("#home-wrapper").style.display="flex",document.querySelector("#game-over-wrapper").style.display="none",document.querySelector("#start-game").disabled=!1})),document.querySelectorAll('input[name="difficulty"]').forEach((e=>{e.addEventListener("change",(function(e){const t=e.target.value;n(t)}))})),window.onclick=function(e){e.target==document.querySelector("#leaderboard-modal-container")?document.querySelector("#leaderboard-modal-container").classList.remove("show"):e.target==document.querySelector("#instructions-modal-container")&&document.querySelector("#instructions-modal-container").classList.remove("show")},window.onload=()=>{localStorage.hasOwnProperty("username")||document.querySelector("#username-modal-container").classList.add("show"),document.querySelector("#username-button").textContent=localStorage.getItem("username")}})();